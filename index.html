<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Connect</title>
  <!-- Updated WalletConnect V2 and Web3.js CDN -->
  <script src="https://unpkg.com/@walletconnect/web3-provider@2.0.0/dist/umd/index.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.9.0/web3.min.js"></script>
</head>
<body>
  <button onclick="connectWC()">Connect Wallet</button>

  <script type="text/javascript">
    let account;

    // Initialize WalletConnect provider with updated RPC URLs
    const provider = new WalletConnectProvider.default({
      rpc: {
        1: "https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID", // Mainnet
        137: "https://rpc-mainnet.maticvigil.com/", // Polygon
      },
    });

    // Function to connect the wallet
    const connectWC = async () => {
      try {
        await provider.enable(); // Enable provider

        // Create a new Web3 instance
        const web3 = new Web3(provider);
        window.w3 = web3;

        // Get connected accounts
        const accounts = await web3.eth.getAccounts();
        account = accounts[0]; // Primary account
        console.log("Connected account:", account);
      } catch (error) {
        console.error("Connection failed:", error);
      }
    };

    // Function to sign a message
    const sign = async (msg) => {
      try {
        if (w3 && account) {
          return await w3.eth.personal.sign(msg, account);
        } else {
          throw new Error("Wallet not connected");
        }
      } catch (error) {
        console.error("Signing failed:", error);
      }
    };

    // Function to create a contract instance
    const contract = (abi, address) => {
      try {
        if (w3) {
          return new w3.eth.Contract(abi, address);
        } else {
          throw new Error("Wallet not connected");
        }
      } catch (error) {
        console.error("Contract initialization failed:", error);
      }
    };

    // Function to disconnect the wallet
    const disconnect = async () => {
      try {
        await provider.disconnect(); // Close provider session
        console.log("Disconnected");
      } catch (error) {
        console.error("Disconnection failed:", error);
      }
    };

    // Example contract address and ABI
    const address = "0x4b4f8ca8fb3e66b5ddafcebfe86312cec486dae1";
    const abi = [
      {
        inputs: [],
        name: "count",
        outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
        stateMutability: "view",
        type: "function",
      },
      {
        inputs: [],
        name: "increment",
        outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
        stateMutability: "nonpayable",
        type: "function",
      },
    ];
  </script>
</body>
</html>
